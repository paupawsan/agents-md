<!--
Copyright (c) 2025 Paulus Ery Wasito Adhi paupawsan@gmail.com

Licensed under the MIT License. See LICENSE file for details.
-->

# メモリシステムセットアップガイド

このガイドでは、開発者向けの完全な技術的なセットアップ手順を提供します。セットアッププロセスには、ファイルパスの設定、ファイルのコピー、ワークスペースアクセスの設定が含まれます。

## 前提条件

- **AIモデル**: エージェント対応モデル (Claude Sonnet/Opus, GPT-4 など)
- **エディタ**: AIエージェント対応のCursorまたはVS Code
- **Python 3.6+** (オプション、自動セットアップスクリプト用)

## ステップ1: リポジトリファイルの取得

リポジトリファイルを取得するには、いくつかの方法があります：

### 方法A: ZIPとしてダウンロード (非技術者向けで最も簡単)

1. GitHubで、緑色の **"Code"** ボタンをクリック
2. **"Download ZIP"** をクリック
3. ZIPファイルがコンピュータにダウンロードされます（通常Downloadsフォルダ）
4. ダウンロードしたZIPファイルをダブルクリックして解凍
5. `agents-md` フォルダが表示されます

**Gitは不要！** コマンドラインツールに慣れていない場合に最も簡単な方法です。

### 方法B: Gitでクローン (開発者向け)

```bash
git clone <repository-url>
cd agents-md
```

### 方法C: 新しいインスタンスの初期化

```bash
mkdir -p ~/Documents/agents-md
cd ~/Documents/agents-md
```

## ステップ2: メモリディレクトリ名の設定

**重要**: `AGENTS.md` の `{MEMORY_DIR}` プレースホルダーを選択したディレクトリ名に置き換える必要があります。

> **💡 ヒント**: `agent-memory`、`my-memory`、`ai-memory` などのシンプルな名前を選択してください

### 方法A: 手動置換 (推奨)

**これは簡単です** - テキストエディタの検索置換機能を使用してください：

1. テキストエディタで `AGENTS.md` を開く
2. 検索置換を使用（通常 `Cmd+F` または `Ctrl+F`）：
   - 検索: `{MEMORY_DIR}`
   - 置換: `your-chosen-name` (例: `agent-memory`、`my-memory` など)
3. すべての出現箇所を置き換える
4. ファイルを保存

**これで完了！** 手動置換はシンプルで完璧に動作します。

### 方法B: Pythonスクリプト (エンジニア向け)

自動化を希望する場合、提供されたPythonスクリプトを使用できます：

```bash
python3 setup_memory_dir.py
```

このスクリプトは以下の処理を行います：
- 選択したディレクトリ名の入力を求める
- 名前を検証（小文字、数字、ハイフン、アンダースコアのみ）
- `AGENTS.md` のすべての `{MEMORY_DIR}` 出現箇所を置き換える
- 変更の概要を表示

**注意**: Python 3.6+が必要です。Pythonやコマンドラインツールに慣れていない場合は、方法A（手動置換）を使用してください。

## ステップ3: プロジェクトへのファイル設定

メモリシステムをプロジェクトに設定するには2つの方法があります：

### 方法A: ワークスペースベースの設定 (Cursor/VS Code推奨)

エディタがワークスペースをサポートする場合（CursorおよびVS Code）、ファイルのコピーではなくリポジトリをワークスペースに直接追加できます：

1. **agents-mdをワークスペースに追加**：
   - コマンドパレットを開く（`Cmd+Shift+P` / `Ctrl+Shift+P`）
   - "Add Folder to Workspace" を選択
   - クローンした `agents-md` フォルダを参照して選択
   - `agents-md` フォルダがワークスペースサイドバーに表示されます

2. **AGENTS.mdが自動的に検出されます**：
   - Cursorの最新バージョンはワークスペース内の `AGENTS.md` ファイルを自動的に検出します
   - `agents-md` フォルダ内の `AGENTS.md` ファイルがアクティブなルールとして使用されます
   - プロジェクトルートに `AGENTS.md` をコピーする必要はありません

3. **_agents-mdフォルダのコピー**（まだ必要）：
   - プロジェクトルートに `_agents-md` フォルダをコピーする必要があります、または
   - `agents-md` フォルダからワークスペースに追加します

**このアプローチの利点**：
- ✅ 各プロジェクトに `AGENTS.md` をコピーする必要がない
- ✅ `agents-md` リポジトリの変更が自動的に適用される
- ✅ プロジェクト構造がクリーンに保たれる
- ✅ 複数のプロジェクトで同じセットアップを簡単に共有できる

### 方法B: ファイルのコピー (従来の方法)

プロジェクトフォルダに以下のファイルをコピーします：

1. **`_agents-md` フォルダ** - AIのメモリシステムプロンプトとガイドラインを含む
2. **`AGENTS.md` ファイル** - エージェントルールとメモリ設定を含む（選択したディレクトリ名で設定済み）

**コマンドラインを使用**：
```bash
# プロジェクトルートから
cp -r /path/to/agents-md/_agents-md .
cp /path/to/agents-md/AGENTS.md ./AGENTS.md
```

**ファイルマネージャを使用**（非技術者向けで簡単）：
- `agents-md` フォルダを参照
- `_agents-md` フォルダと `AGENTS.md` ファイルをコピー
- プロジェクトフォルダを参照
- 両方のアイテムを貼り付け

> **💡 詳細なファイルコピー手順**については、[SIMPLE_SETUP.md](SIMPLE_SETUP.md) ステップ4を参照してください。

**重要**: プロジェクトにすでに `AGENTS.md` ファイルがある場合、競合を避けるため、agents-mdの `AGENTS.md` の内容を既存ファイルの末尾に**追加**してください。

**✅ 互換性に関する注意**: agents-mdは既存のCursorルールおよびユーザールールと完全に互換性があります。メモリシステムルールは既存の `AGENTS.md` 内容と連携して動作します。

## ステップ4: 言語選択 (オプション)

**AGENTS.md** は英語と日本語の両方をサポートしています。提供されたスクリプトまたは手動設定を使用して言語を選択できます。

### 方法A: 自動スクリプト (推奨)

提供されたPythonスクリプトを使用して言語を切り替えます：

```bash
# 日本語に切り替え
python3 switch_agents_lang.py ja

# 英語に切り替え
python3 switch_agents_lang.py en

# 現在の言語を確認
python3 switch_agents_lang.py
```

スクリプトは個別のソースファイル（`AGENTS.md.en` および `AGENTS.md.ja`）を維持し、選択に基づいて適切なものを `AGENTS.md` にコピーします。

**⚠️ 重要**: 言語を切り替えた後、スクリプトは構成された `MEMORY_PATH` を自動的に維持しようとします。ただし、スクリプトが構成されたパスを検出できない場合、新しい言語テンプレートでメモリパスを構成するために `setup_memory_dir.py` を再度実行する必要があります：

```bash
# 言語切り替え後にMEMORY_PATHを構成する必要がある場合：
python3 setup_memory_dir.py
```

スクリプトは `MEMORY_PATH` をまだ構成する必要がある場合に警告します。

### 方法B: 手動設定 (シンプルな代替)

スクリプトを使用しない場合、または手動設定を希望する場合、テンプレートファイルをクローンして名前を変更できます：

**英語の場合**：
```bash
# 英語テンプレートをAGENTS.mdにコピー
cp AGENTS.md.en AGENTS.md
```

**日本語の場合**：
```bash
# 日本語テンプレートをAGENTS.mdにコピー
cp AGENTS.md.ja AGENTS.md
```

**注意**: プロジェクトルートに単一の `AGENTS.md` ファイルを維持することを想定しています。`AGENTS.md.en` と `AGENTS.md.ja` ファイルは、言語設定に基づいて `AGENTS.md` にクローンして名前変更するテンプレートとして機能します。

**⚠️ 重要**: 手動コピー後、**メモリパスを設定する必要があります**：
1. `MEMORY_PATH` を設定するために `setup_memory_dir.py` を実行：
   ```bash
   python3 setup_memory_dir.py
   ```
   または手動で `AGENTS.md` の設定セクションのパスを置き換える：
   ```
   **MEMORY_PATH**: `/path/to/your/memory-root`
   ```

**注意**: 言語切り替えは `AGENTS.md` にのみ影響します。ドキュメントファイル（例: `README.md`）には別々の日本語バージョン（例: `README.ja.md`）があり、エージェント機能には影響しません。

## ステップ5: AGENTS.mdでのメモリパスの設定

**重要**: プロジェクトに `AGENTS.md` をコピーした後、メモリパスを設定する必要があります。

1. プロジェクトルートで `AGENTS.md` を開く
2. 上部の**設定**セクションを見つける
3. この行のパスを置き換える：
   ```
   **MEMORY_PATH**: `/path/to/your/memory-root`
   ```
   実際のメモリディレクトリパスに置き換える

**プラットフォーム固有の例**：
- **macOS**: `~/Library/CloudStorage/GoogleDrive-you@gmail.com/My Drive/AI/your-memory-dir` または `~/Documents/your-memory-dir`
- **Linux**: `~/Documents/your-memory-dir` または `~/.local/share/your-memory-dir`
- **Windows**: `%USERPROFILE%\Documents\your-memory-dir` または `%APPDATA%\your-memory-dir`

**注意**: パスは1箇所だけ置き換えれば十分です。エージェントは `MEMORY_PATH` がドキュメント全体のすべてのパス参照に適用されることを理解します。

**代替方法**: 自動設定には `setup_memory_dir.py` スクリプトを使用：
```bash
python3 setup_memory_dir.py
```

## ステップ6: ワークスペースへのメモリディレクトリの追加

**重要**: CursorとVS Codeはデフォルトでワークスペース外のファイルにアクセスできません。メモリシステムのファイルアクセス許可を有効にするため、プロジェクトワークスペースにメモリディレクトリを**追加する必要があります**。

> **💡 このステップで助けが必要ですか？** トラブルシューティングのヒント付き詳細手順については、[SIMPLE_SETUP.md](SIMPLE_SETUP.md) ステップ6を参照してください。

### なぜこれが必要か

- **ファイルアクセス制限**: Cursor/VS Codeエージェントはセキュリティ上の理由でワークスペース内のファイルにのみアクセスできます
- **メモリの場所**: メモリディレクトリは通常プロジェクト外に保存されます（例: `~/Documents/` またはクラウドストレージ）
- **解決策**: メモリディレクトリをワークスペースに追加すると、ファイルアクセス許可が昇格され、エージェントがメモリファイルを読み書きできるようになります

### 方法1: コマンドパレットを使用 (最も簡単)

**Cursor/VS Codeで**：
1. コマンドパレットを開く：
   - **macOS**: `Cmd+Shift+P`
   - **Windows/Linux**: `Ctrl+Shift+P`
2. "Add Folder to Workspace" または "Workspaces: Add Folder to Workspace" を選択
3. `AGENTS.md` で構成したディレクトリ（メモリディレクトリ）を参照して選択
   - 例: `~/Library/CloudStorage/GoogleDrive-you@gmail.com/My Drive/AI/your-memory-dir`
   - または: `~/Documents/your-memory-dir`
4. メモリディレクトリがワークスペースサイドバーに別のフォルダとして表示されます

### 方法2: ワークスペースファイルを使用 (マルチフォルダワークスペース用)

`.code-workspace` ファイルを使用してワークスペースを管理する場合：

1. プロジェクトルートに `.code-workspace` ファイルを編集または作成：
```json
{
  "folders": [
    {
      "path": "."
    },
    {
      "path": "/Users/username/Documents/your-memory-dir"
    }
  ],
  "settings": {}
}
```

2. 2番目の `path` を実際のメモリディレクトリパスに置き換える
3. "File > Open Workspace from File..." を選択し、`.code-workspace` ファイルを開く

### 方法3: ワークスペース設定を使用 (代替)

1. コマンドパレットを開く（`Cmd+Shift+P` / `Ctrl+Shift+P`）
2. "Preferences: Open Workspace Settings" を選択
3. エディタバージョンでサポートされている場合、ワークスペース設定にメモリディレクトリパスを追加

### 検証

ワークスペースにメモリディレクトリを追加した後：
- ✅ メモリディレクトリがワークスペースサイドバーに表示される
- ✅ エディタでメモリファイルを閲覧できる
- ✅ エージェントがメモリファイルを読み書きできる

**注意**: クラウドストレージ（Google Drive、iCloudなど）を使用する場合、ワークスペースに追加する前にパスがアクセス可能でディレクトリが存在することを確認してください。

## ステップ7: プロジェクトのメモリ初期化

現在のプロジェクトのメモリ構造を初期化するには、エージェントが理解する自然言語プロンプトを使用します。例：

**英語**：
```
construct memory
initialize memory for this project
set up project memory
create memory structure
```

**日本語**：
```
メモリを構築
このプロジェクトのメモリを初期化
プロジェクトメモリをセットアップ
メモリ構造を作成
```

エージェントは構成されたメモリディレクトリでメモリ構造を自動的に作成し、プロジェクトアーキテクチャとパターンを文書化するインデックスファイルと初期ナレッジファイルを含みます。

## ステップ8: エージェントコマンド許可の設定

**重要**: メモリシステムでは、エージェントがメモリファイルを作成、読み取り、書き込みするためにファイルシステムコマンドを実行する必要があります。これはエディタからの明示的な許可が必要です。

### エージェントが実行する可能性のあるコマンド

エージェントは以下のタイプのコマンドを実行する場合があります（これらは安全なファイル操作です）：
- **ファイル/フォルダ作成**: `mkdir`、`touch` - メモリディレクトリとファイルの作成
- **ファイル読み取り**: `cat`、`head`、`grep` - メモリファイルの読み取りと検索
- **ファイル書き込み**: `echo`、`printf` - メモリコンテンツをファイルに書き込み
- **ファイル操作**: `cp`、`mv`、`ls` - メモリファイルの整理と管理

### 許可要件

**エディタまたはシステムでこれらのコマンドをホワイトリスト化する必要があります**：

**Cursorの場合**：
- Settings → Agent → Command Execution に移動
- 許可されたコマンドリストに上記のコマンドを追加
- またはエージェント操作中にプロンプトが表示されたら "Allow" をクリック

**VS Codeの場合**：
- VS Code拡張機能でAIアシスタント設定を確認
- コマンド実行許可を確認

**アンチウイルス/セキュリティソフトウェアの場合**：
- これらの操作をブロックするアンチウイルスプログラムがある場合があります
- プロジェクトフォルダとメモリディレクトリを例外に追加
- エディタからのファイル操作を許可

### なぜこれが必要か

- **セキュリティ**: エディタは安全のために任意のコマンド実行を防止します
- **ファイルアクセス**: メモリファイルはプロジェクトワークスペース外に保存されます
- **システム統合**: メモリシステムが正しく機能するために必要です

**注意**: これらのコマンドは**安全なファイル操作のみ**です - ソフトウェアのインストールやインターネットアクセスはできません。メモリシステムはテキストファイルの作成、読み取り、書き込みのみを行います。

## ステップ9: 設定の検証

以下の項目を確認してください：
- ✅ `_agents-md` フォルダがプロジェクトルートに存在する
- ✅ `AGENTS.md` がプロジェクトルートに存在する（選択した名前で `{MEMORY_DIR}` が置き換えられている）
- ✅ `AGENTS.md` のメモリパスがメモリディレクトリを指している
- ✅ メモリディレクトリがCursorワークスペースに追加されている
- ✅ メモリディレクトリが存在し、書き込み可能である

## トラブルシューティング

### メモリディレクトリにアクセスできない
- **問題**: エージェントがメモリファイルを読み書きできない
- **解決策**: ステップ6でメモリディレクトリがワークスペースに追加されていることを確認

### コマンドが実行されない
- **問題**: エージェントがディレクトリを作成したりファイルを作成できない
- **解決策**: ステップ8でエージェントコマンド許可を確認

### パスが見つからない
- **問題**: メモリパスが非存在ディレクトリを指している
- **解決策**: ステップ5で `AGENTS.md` のパスがシステムと一致することを確認

### 複数のAGENTS.mdファイル
- **問題**: エージェント設定が競合する
- **解決策**: ステップ3の方法A（ワークスペースベース設定）を使用するか、手動でファイルをマージ

## 次のステップ

セットアップが完了したら、メモリシステムの効果的な使用方法については [使用ガイド](usage-guide.md) を参照してください。
