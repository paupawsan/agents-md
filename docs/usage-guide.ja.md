<!--
Copyright (c) 2025 Paulus Ery Wasito Adhi paupawsan@gmail.com

Licensed under the MIT License. See LICENSE file for details.
-->

# メモリシステム使用ガイド

このガイドでは、開発ワークフローでagents-mdメモリシステムを効果的に使用する方法を説明します。メモリシステムは、AIコーディングエージェント向けのインテリジェントでRAG最適化された知識管理を提供します。

## メモリ構造

メモリシステムは情報を3つのカテゴリに整理します：

### 1. プロジェクト固有メモリ (`{MEMORY_DIR}/[project-name]/`)
- **目的**: 現在のプロジェクトに固有の知識
- **内容**:
  - プロジェクトアーキテクチャの決定
  - プロジェクト固有のパターンと修正
  - プロジェクトファイルの場所
  - プロジェクト固有の設定
- **アクセス**: このプロジェクトで作業する場合に自動的に使用される

### 2. 共通メモリ (`{MEMORY_DIR}/common/`)
- **目的**: ユーザー設定とプロジェクト横断パターン
- **内容**:
  - ユーザー設定（すべてのプロジェクトに適用）
  - グローバル設定と構成
  - プロジェクト横断パターン
  - ユーザー作業フロー
- **アクセス**: すべてのプロジェクトで利用可能

### 3. プライベートメモリ (`{MEMORY_DIR}/private/`) ⚠️
- **目的**: 機密情報の保存
- **内容**:
  - APIキー、パスワード、トークン
  - 個人情報
  - 機密設定
- **⚠️ 重要**: プライベートメモリファイルをバージョン管理にコミットしない

## エージェントがメモリを使用する方法

エージェントはほとんどのメモリ操作を自動的に処理します：

### 自動メモリ管理
- **重要なタスクやパターンの学習後にメモリを同期**
- **コンテキストが失われたり不明瞭な場合にメモリを確認**
- **新しい知識を作成したりセッションを作成したりする場合にインデックスファイルを更新**
- **関連するセッションを統合してクリーンな組織を維持**
- **RAGを使用して関連するメモリのみを取得し、トークン使用量を最小化**

### 手動メモリ操作（必要時）

#### メモリ初期化
```
Initialize memory for this project. Create the memory structure in the configured memory directory, including index files and initial knowledge files documenting the project architecture and patterns.
```

#### 手動メモリ同期
```
Sync memory for this project. Update index files, consolidate recent sessions if needed, and ensure index.json is synchronized with actual files in knowledge/ and sessions/ directories.
```

#### メモリ更新
```
Update project memory with current status. Document recent changes, update index files, and sync any new patterns or architectural decisions.
```

## RAG（検索拡張生成）機能

メモリシステムは高度なRAG機能を使用してインテリジェントな情報検索を行います：

### RAGの仕組み
- **マルチレベルインデックス作成**: インデックス優先ルックアップで即時アクセス
- **セマンティック検索**: 自然言語クエリで関連メモリを検索
- **選択的読み取り**: コンテキストに読み込まれるのは関連セクションのみ
- **トークン最適化**: 完全ファイル読み込みと比較して80-95%のトークン削減

### 利点
- ✅ **トークン使用量の削減**: 関連メモリのみがコンテキストに読み込まれる
- ✅ **インテリジェントな検索**: エージェントはコンテキストを理解し、関連情報を自動的に取得
- ✅ **高速アクセス**: マルチレベルインデックス作成で即時ルックアップ
- ✅ **スケーラブル**: 大規模メモリデータベースを効率的に処理

## プロンプト例

メモリシステムを操作するための実用的なプロンプト例：

### トピックとパターンの取得
```
What topics are documented in memory for this project?
Show me all the patterns we've established for this project.
What are the documented topics in the knowledge/ directory?
List all architectural patterns we've documented.
```

### 特定の情報の検索
```
What did we decide about error handling in this project?
Check memory for how we handle authentication.
What patterns exist for API integration?
Find previous solutions to similar problems.
```

### ユーザー設定の確認
```
What are my preferences for this project?
Check common preferences that apply to all projects.
What project-specific preferences are set?
```

### アーキテクチャ決定の確認
```
What architectural decisions were made for this project?
Show me the architecture documentation from memory.
What design patterns are we using?
```

### セッションサマリの検索
```
What work was done in recent sessions?
Show me the last few session summaries.
What was completed in the last week?
```

### プロジェクトステータスの確認
```
What's the current status of this project?
Show me recent fixes and updates.
What are the known issues and their solutions?
```

### 新しいパターンの学習
```
Remember this pattern: [パターンを説明]
Document this architectural decision: [決定を説明]
Add this to project knowledge: [知識を説明]
```

## メモリファイルタイプ

### 知識ファイル (`knowledge/topic_name.md`)
- **目的**: パターンとアーキテクチャの継続的なドキュメント
- **構造**: セマンティックタグとキーワードを含むMarkdownファイル
- **使用法**: 時間の経過とともに進化する長期知識

### セッションアーカイブ (`sessions/YYYY-MM/YYYY-MM-DD_summary.md`)
- **目的**: 時間で整理された作業セッションの統合
- **構造**: 完了した作業の時間別サマリー
- **使用法**: いつ何が行われたかの歴史的参照

### インデックスファイル (`index.json`, `index.md`)
- **目的**: 高速検索とクイックリファレンス
- **構造**: メモリメタデータへの機械可読および人間可読インデックス
- **使用法**: メモリメタデータへの即時アクセス

## ワークフローオプション

### 構造化ワークフロー（複雑なプロジェクトに推奨）
- **最適**: 大規模プロジェクト、チームコラボレーション、複雑なアーキテクチャ
- **機能**: トピック、セッション、インデックス作成を含むフルメモリシステム
- **構造**: クロスリファレンス付き整理された知識ベース
- **保守**: 定期的な統合とインデックス作成が必要

### シンプルワークフロー（ビベコーディングと実験用）
- **最適**: クイックプロトタイプ、個人実験、小規模プロジェクト
- **機能**: 毎日のログ記録用の単一ファイルテンプレート
- **構造**: 迅速な反復に焦点を当てた最小限の整理
- **保守**: オーバーヘッドが低い、保守が容易

`templates/README.md` で適切なワークフローの選択に関するガイダンスを参照してください。

## ベストプラクティス

### メモリを使用する場合
- **新規プロジェクト**: パターンを確立するためにメモリを初期化
- **問題解決**: 以前の解決策をメモリで確認
- **アーキテクチャ決定**: 重要な選択を文書化
- **パターン認識**: 繰り返される解決策から学習
- **知識転送**: プロジェクト間で洞察を共有

### メモリ保守
- **定期同期**: エージェントに自動同期を許可
- **手動確認**: エージェントが学んだことを定期的に確認
- **統合**: エージェントが断片化されたメモリを統合できるようにする
- **プライバシーチェック**: 機密情報がプライベートメモリに保存されていることを確認

### 効果的なプロンプト
- **具体的**: "APIエラーハンドリングについて何を決定したか？" vs "APIについて？"
- **コンテキストを含む**: 関連する場合にプロジェクト固有の詳細を含める
- **自然言語**: 同僚に尋ねるようにプロンプトを書く
- **フォローアップ**: 結果が期待通りでない場合は明確化を求める

## プライバシーとセキュリティ

### プライベートメモリ処理
- **自動検出**: エージェントが機密情報を自動的に検出するはず
- **手動オーバーライド**: 機密データをプライベートメモリに明示的に保存するためのプロンプトを使用
- **アクセス制御**: 必要な場合にのみプライベートメモリにアクセス
- **バージョン管理**: Gitにプライベートメモリファイルをコミットしない

### セキュリティベストプラクティス
- **ローカル保存**: メモリはあなたのマシンに残る
- **外部送信なし**: メモリを外部サービスに送信するAPI呼び出しなし
- **ファイル権限**: OSレベルの権限を使用してアクセスを制御
- **暗号化**: 機密メモリファイルを暗号化することを検討

## プラットフォーム固有機能

メモリシステムにはプラットフォーム固有の最適化が含まれます：

### macOS
- **クラウドストレージ検出**: iCloud、Google Driveを自動的に検出
- **Spotlight統合**: 検索機能の強化
- **パス解決**: macOS固有のパス規則の処理

### Linux
- **ファイルシステム最適化**: 効率的なファイル操作
- **検索ツール**: 最適化された検索ユーティリティの使用
- **権限処理**: 適切なLinux権限管理

### Windows
- **PowerShell統合**: コマンド実行の強化
- **WSLサポート**: Windows Subsystem for Linux内での動作
- **パス解決**: Windows固有のパスとUNCの処理

## メモリ問題のトラブルシューティング

### メモリが使用されていない
- **セットアップの確認**: `AGENTS.md` が適切に構成されていることを確認
- **ワークスペースアクセス**: メモリディレクトリがワークスペースにあることを確認
- **権限**: エージェントコマンド権限を確認
- **モデル機能**: エージェント対応モデルを使用していることを確認

### 誤った情報が取得された
- **プロンプトの明確化**: プロンプトをより具体的にする
- **メモリの質**: 保存された情報を確認して修正
- **インデックス更新**: 必要に応じてインデックスを手動更新
- **統合**: エージェントが断片化されたメモリを統合できるようにする

### メモリファイルが作成されない
- **ディレクトリアクセス**: メモリディレクトリが書き込み可能であることを確認
- **コマンド権限**: エージェントがファイル操作を実行できることを確認
- **パス設定**: `AGENTS.md` のパスがシステムと一致することを確認
- **ワークスペース設定**: ワークスペースにメモリディレクトリが含まれていることを確認

### パフォーマンス問題
- **大規模メモリベース**: 古いセッションを統合することを検討
- **インデックス破損**: 必要に応じてインデックスを再構築
- **プラットフォーム問題**: プラットフォーム固有の最適化を確認
- **トークン制限**: より具体的なクエリを使用してコンテキストサイズを減らす

## 高度な使用法

### カスタムメモリ組織
- **デフォルトのオーバーライド**: カスタムディレクトリ構造を構成
- **複数のメモリベース**: 異なるコンテキストで異なるメモリディレクトリを使用
- **統合**: 他のメモリシステムやデータベースと統合

### メモリアナリティクス
- **パターンの確認**: どのような種類の情報が保存されているかを分析
- **使用統計**: メモリアクセスパターンを追跡
- **品質評価**: メモリ精度を定期的に確認
- **最適化**: ストレージと検索戦略を改良

### 他のツールとの統合
- **バージョン管理**: メモリファイルはGitワークフローで動作
- **ドキュメント**: プロジェクトドキュメントとしてメモリを使用
- **知識共有**: チーム共有のためにメモリをエクスポート
- **バックアップ**: メモリディレクトリの定期バックアップ戦略

## ヘルプの取得

問題が発生した場合：
1. [セットアップガイド](setup-guide.md) で設定問題を確認
2. [メモリシステムテスト](memory-system-testing/) で検証手順を確認
3. `_agents-md/memory/` の詳細ドキュメントを確認
4. AIアシスタントに助けを求める（必要な機能をサポートしていることを確認）

メモリシステムは、プロジェクトのニーズに適応するインテリジェントで文脈を意識した知識管理を提供することで、開発ワークフローを強化するように設計されています。
