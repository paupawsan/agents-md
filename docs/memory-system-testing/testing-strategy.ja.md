<!--
Copyright (c) 2025 Paulus Ery Wasito Adhi paupawsan@gmail.com

Licensed under the MIT License. See LICENSE file for details.
-->

# メモリシステムテスト戦略

## 概要

メモリシステムの実装をテストして、信頼できるストレージ、正確な検索、プライバシー準拠、およびクリティカルシンキングおよびRAG戦略との効果的な統合を確保します。

## テストカテゴリ

### 1. メモリストレージ精度テスト

**プライバシー準拠検証**:
- **入力**: 大規模プロジェクトでのTypeScript使用に関するユーザー設定を保存
- **期待される結果**: 情報が適切な場所（common/、private/以外）に保存される
- **検証**: ファイル内容とディレクトリ構造を確認し、プライベートデータが漏洩していないことを確認

**分類正確性**:
- **入力**: Reactコンポーネントアーキテクチャに関するパターンを学習
- **期待される結果**: topic/ディレクトリに適切な命名で保存される
- **検証**: ファイル組織が命名規則に従っていることを確認

### 2. 検索精度テスト

**RAG戦略効果性**:
- **入力**: 関連情報を保存した後に「Reactコンポーネントパターン」についてクエリ
- **期待される結果**: 関連情報が検索され、無関係な情報がフィルタリングされる
- **検証**: 検索関連性とトークン効率を確認（80-95%削減）

**セマンティック検索品質**:
- **入力**: メモリにREST APIパターンが含まれている場合に「APIをどのように構造化すべきか？」と尋ねる
- **期待される結果**: REST APIパターンを返す、無関係な情報ではない
- **検証**: セマンティックマッチングの精度と偽陽性/陰性率を評価

### 3. メモリ組織テスト

**ファイル構造準拠**:
- **入力**: 2025年11月の作業からのセッション情報を保存
- **期待される結果**: session/2025-11/ディレクトリを適切な命名で作成
- **検証**: ディレクトリ構造とファイル命名規則を確認

**インデックスファイル精度**:
- **入力**: 新しいトピックを追加した後にメモリインデックスを更新
- **期待される結果**: インデックスが現在のメモリ状態を正確に反映
- **検証**: インデックスエントリと実際に保存されたコンテンツを相互参照

### 4. プラットフォーム固有機能テスト

**クロスプラットフォーム互換性**:
- **入力**: macOS（クラウドストレージ付き）でのメモリ操作をテスト
- **期待される結果**: 適切なパス検出とクラウドストレージ統合
- **検証**: プラットフォーム固有の最適化が正しく動作することを確認

**パス解決テスト**:
- **入力**: ユーザーhomedirectoryを含むメモリパスを設定
- **期待される結果**: 正しいパス展開と解決
- **検証**: 実際のファイルシステムパスが期待値と一致することを確認

### 5. 統合テスト

**クリティカルシンキング + メモリ統合**:
- **入力**: パターンを確立し、そのパターンを参照すべきクリティカルシンキング質問をする
- **期待される結果**: クリティカルシンキングが保存されたパターンを決定に考慮
- **検証**: 応答が確立されたメモリパターンを参照することを確認

**コマンド安全性統合**:
- **入力**: 潜在的に危険なメモリ操作を試行
- **期待される結果**: コマンド検証が危険な操作を防止
- **検証**: 安全性ルールが適用されていることを確認

### 6. パフォーマンスと信頼性テスト

**トークン最適化効率**:
- **入力**: 大規模メモリ検索を必要とするクエリ
- **期待される結果**: 80-95%のトークン削減
- **検証**: トークン使用量を完全内容検索と比較

**メモリ一貫性テスト**:
- **入力**: シーケンスでの複数回の読み取り/書き込み操作
- **期待される結果**: 操作間でメモリ状態が一貫して維持される
- **検証**: 同時操作後のデータ整合性を確認

## 自動テストシナリオ

### ユニットテストケース

```javascript
// プライバシー準拠をテスト
test('privacy-compliant-storage', () => {
  const result = memory.store('user email: test@example.com');
  expect(result.location).toBe('private/');
  expect(result.publicLeak).toBe(false);
});

// 分類精度をテスト
test('topic-categorization', () => {
  const result = memory.categorize('React component patterns');
  expect(result.category).toBe('topic');
  expect(result.filename).toMatch(/react.*patterns/);
});

// RAG効果性をテスト
test('rag-token-optimization', () => {
  const retrieval = memory.retrieve('API design patterns');
  expect(retrieval.tokenReduction).toBeGreaterThan(0.8);
  expect(retrieval.relevanceScore).toBeGreaterThan(0.7);
});
```

### 統合テストケース

```javascript
// メモリ + クリティカルシンキング統合をテスト
test('memory-critical-thinking-integration', () => {
  // まずパターンを確立
  memory.storePattern('Use TypeScript for complex projects');

  // 次にクリティカルシンキングがそれを使用することをテスト
  const response = agent.process('Should we use JS or TS for our enterprise app?');
  expect(response.memoryReferenced).toBe(true);
  expect(response.patternsConsidered).toContain('TypeScript');
});

// プラットフォーム固有機能をテスト
test('platform-path-resolution', () => {
  const config = memory.configurePath('~/Documents/memory');
  expect(config.resolvedPath).toMatch(/^\/Users\//); // macOS resolution
  expect(config.cloudStorage).toBe(true); // Detects iCloud
});
```

## 手動テストチェックリスト

### ストレージと検索テスト
- [ ] プライベートデータが正しくprivate/ディレクトリにルーティングされる
- [ ] プロジェクト固有データが正しいプロジェクトフォルダに保存される
- [ ] 共通パターンがcommon/ディレクトリに保存される
- [ ] セッションデータが適切な日付組織でアーカイブされる
- [ ] メモリ検索が関連性があり、重複しない情報を返す
- [ ] セマンティック検索が概念的に関連するコンテンツを見つける

### 組織と構造テスト
- [ ] ファイル命名が確立された規則に従う
- [ ] ディレクトリ構造がアーキテクチャガイドラインに一致する
- [ ] インデックスファイルがコンテンツと同期を維持する
- [ ] メモリ統合が情報を失わない
- [ ] トピック分類が一貫性があり論理的である

### プラットフォームと統合テスト
- [ ] macOSクラウドストレージ統合が動作する
- [ ] Linuxファイルシステム最適化が適用される
- [ ] Windows WSL互換性が維持される
- [ ] クリティカルシンキングが適切にメモリをクエリする
- [ ] コマンド安全性ルールが危険な操作を防ぐ

### パフォーマンステスト
- [ ] 大規模メモリ検索がトークン最適化目標を達成する
- [ ] メモリ操作が合理的な時間制限内で完了する
- [ ] 同時メモリアクセスが破損を引き起こさない
- [ ] メモリ増加が管理される（無制限の拡張なし）

## 成功指標

### 定性的指標
- **プライバシー準拠**: 機密情報が公開領域に漏洩しない
- **検索精度**: ユーザーが過度の検索なしで見つけたいものを見つける
- **組織の明確性**: メモリ構造が直感的で保守可能
- **統合品質**: メモリがクリティカルシンキングを複雑化せず強化する

### 定量的指標
- **トークン効率**: RAGによる80-95%のコンテキストトークン削減
- **検索精度**: 検索された情報の>85%が関連性がある
- **ストレージ精度**: 情報の>95%が正しいカテゴリに保存される
- **プラットフォーム互換性**: すべてのサポートされたプラットフォームで修正なしで動作

## 継続的改善

### フィードバックループ
1. **監視**: 実際の使用でメモリシステムのパフォーマンスを追跡
2. **分析**: 一般的な検索失敗や組織問題を特定
3. **改良**: 観察されたパターンに基づいて分類ルールを更新
4. **テスト**: 拡張されたテストシナリオで改善を検証

### エッジケース発見
- **大規模メモリベース**: 広範なメモリコレクションでテスト
- **クロスプラットフォーム移行**: プラットフォーム間のメモリ転送をテスト
- **メモリ破損回復**: データ破損に対するシステム回復力をテスト
- **同時アクセス**: 同時メモリ操作下の動作をテスト
