<!--
Copyright (c) 2025 Paulus Ery Wasito Adhi paupawsan@gmail.com

Licensed under the MIT License. See LICENSE file for details.
-->

# メモリシステム実践テストガイド

## クイックテストシナリオ

### テスト1: プライバシー準拠検証
**プロンプト**: "Remember that my email is john.doe@company.com and I prefer using dark mode"

**期待されるメモリシステム応答**:
- 個人情報をすぐに認識する
- メールをprivate/ディレクトリにのみ保存
- 設定をcommon/ディレクトリに保存
- プライベート情報と公開情報を混在させない

**❌ 失敗指標**:
- メールをcommon/またはprojectディレクトリに保存
- 個人情報を公開メモリ領域に漏洩
- プライベートと公開データを分離しない

### テスト2: 分類精度
**プロンプト**: "I've learned that we should always use TypeScript interfaces for API responses in this project"

**期待されるメモリシステム応答**:
- これをプロジェクト固有のパターンとして認識
- 適切なプロジェクトtopic/ディレクトリに保存
- 説明的なファイル名を使用（例: typescript-api-patterns.md）
- 再利用可能な知識として分類し、セッションデータではない

**❌ 失敗指標**:
- プロジェクトパターンをcommon/ディレクトリに保存
- 一般的な不明瞭なファイル名を使用
- 一時的なセッションデータとして保存し、トピック知識ではない

### テスト3: 検索効果性
**プロンプト**: "What patterns do we have for API error handling?"（関連パターンを保存した後）

**期待されるメモリシステム応答**:
- 関連するAPIエラーハンドリングパターンを検索
- 無関係な情報をフィルタリング
- コンテキストに適切な量の詳細を提供
- RAGを使用してトークン使用量を最適化

**❌ 失敗指標**:
- 無関係な情報を返す
- コンテキストが多すぎるか少なすぎる
- トークン効率を最適化しない
- 保存されたパターンを完全にミスする

### テスト4: RAG戦略検証
**高コンテキストクエリ**: "Show me all our authentication patterns and security practices"

**期待される応答**:
- インデックス優先アプローチを使用して関連ファイルを見つける
- ファイル全体ではなく必要なセクションのみを取得
- 80-95%のトークン削減を達成
- 情報完全性を維持

**低コンテキストクエリ**: "Quick reminder: what's our logging strategy?"

**期待される応答**:
- インデックスファイルでのクイック検索
- 最小限のコンテキスト検索
- 重要な情報のみで高速応答
- シンプルなクエリに効率的

### テスト5: プラットフォーム固有機能
**macOSクラウドストレージ**: iCloud同期フォルダにメモリパスを設定

**期待される応答**:
- macOSプラットフォームを検出
- クラウドストレージ統合を有効化
- パス解決を正しく処理
- デバイス間で同期を維持

**Linux最適化**: Linuxシステムでのメモリ操作をテスト

**期待される応答**:
- ファイルシステム最適化を適用
- 効率的な検索ツールを使用
- 適切な権限処理
- Linuxファイル操作に最適化

## テストコマンド

### プライバシー分離をテスト
```bash
# プライバシー準拠をテスト
echo "Store personal info: email=user@company.com, api_key=secret123" > test_input
# 期待される結果: emailとapi_keyがprivate/に、common/には何も

# 設定保存をテスト
echo "Remember: I prefer tabs over spaces" > test_input
# 期待される結果: common/preferences.mdに保存
```

### 分類ロジックをテスト
```bash
# トピック分類をテスト
echo "Pattern: Use factory pattern for object creation" > test_input
# 期待される結果: topic/design-patterns.mdに保存

# セッションアーカイブをテスト
echo "Today we implemented user authentication" > test_input
# 期待される結果: session/YYYY-MM/ディレクトリに保存
```

### RAG効果性をテスト
```bash
# セマンティック検索をテスト
# クエリ: "database optimization techniques"
# 期待される結果: 関連するDBパターンを返す、無関係なコードではない

# トークン最適化をテスト
# 大規模メモリ検索を必要とするクエリ
# 期待される結果: トークン使用量 < 完全コンテンツサイズの20%
```

## テスト実行プロセス

### 1. テスト環境のセットアップ
```bash
# テストメモリ構造を作成
mkdir test-memory-root
cd test-memory-root
mkdir -p common private project1/topic project1/session/2025-11

# テストデータで初期化
echo "Test preference: use TypeScript" > common/preferences.md
echo "Personal email: test@example.com" > private/personal.md
echo "Project pattern: API versioning" > project1/topic/api-patterns.md
```

### 2. テストシナリオの実行
各シナリオについて:
1. テスト入力/プロンプトを提示
2. メモリストレージ動作を観察
3. 検索精度を確認
4. プライバシー準拠を検証
5. パフォーマンス指標を測定
6. 偏差を文書化

### 3. 結果の分析
```markdown
## メモリシステムテスト結果

### シナリオ: プライバシー準拠
- **期待される結果**: 個人データはprivate/に、設定はcommon/に
- **実際**: [観察されたストレージ動作]
- **合格/不合格**: [ ]
- **トークン効率**: [X%削減]
- **メモ**: [プライバシー漏洩または分類問題]

### シナリオ: 検索精度
- **期待される結果**: 関連パターンが返され、無関係がフィルタリング
- **実際**: [検索結果]
- **合格/不合格**: [ ]
- **関連性スコア**: [X%関連結果]
- **メモ**: [偽陽性/陰性]
```

## 一般的なテスト失敗と修正

### 問題: プライベートデータ漏洩
**症状**: 個人情報が公開メモリ領域に表示される
**修正**: プライバシー検出ロジックを確認、private/ディレクトリルーティングを検証

### 問題: 分類不良
**症状**: 情報が間違ったディレクトリまたは命名不良で保存される
**修正**: 分類ルールをレビュー、セマンティック理解を改善

### 問題: 検索非効率
**症状**: 無関係な情報が多すぎるか、関連データをミスする
**修正**: RAGアルゴリズムを調整、セマンティック検索品質を改善

### 問題: プラットフォーム互換性問題
**症状**: 特定のプラットフォームでメモリ操作が失敗する
**修正**: プラットフォーム検出とプラットフォーム固有のコードパスを検証

## 高度なテスト

### A/Bテスト
```bash
# 異なるメモリサイズで同じクエリをテスト
# シナリオA: 小規模メモリベース（5トピック）
# シナリオB: 大規模メモリベース（50+トピック）

# 検索精度とパフォーマンスを比較
# 期待される結果: 類似の精度、スケーリングされたパフォーマンス
```

### エッジケーステスト
- **空メモリ**: 保存された情報がない場合の動作をテスト
- **破損ファイル**: 誤った形式のメモリファイルからの回復をテスト
- **権限問題**: 書き込みアクセスが拒否された場合の動作をテスト
- **クロスプラットフォーム移行**: 異なるOS間のメモリ転送をテスト

### パフォーマンステスト
- **大規模検索**: 広範なメモリコレクションでテスト
- **同時アクセス**: 複数の同時メモリ操作をテスト
- **メモリ増加**: 拡張使用でのメモリサイズを監視
- **クエリ応答時間**: 異なるクエリタイプの検索速度を測定

## 成功基準

✅ **プライバシー準拠**: 個人/機密データが公開領域に漏洩しない
✅ **ストレージ精度**: 正しいカテゴリと適切な命名で情報が保存される
✅ **検索品質**: 関連情報が効率的に見つかり、無関係がフィルタリングされる
✅ **RAG効果性**: 80-95%のトークン削減で情報品質を維持
✅ **プラットフォーム互換性**: すべてのサポートされたプラットフォームで確実に動作
✅ **統合品質**: クリティカルシンキングを複雑化せず強化
